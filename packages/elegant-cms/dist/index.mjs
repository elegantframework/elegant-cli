"use client"
import se from"react";import x from"react";import s,{useEffect as I}from"react";import{Card as L,ElegantLogo as M,MetaTitle as T}from"@brandonowens/elegant-ui";import j from"next/link";import*as m from"react";function A({title:e,titleId:r,...o},n){return m.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":r},o),e?m.createElement("title",{id:r},e):null,m.createElement("path",{fillRule:"evenodd",d:"M18 10a.75.75 0 0 1-.75.75H4.66l2.1 1.95a.75.75 0 1 1-1.02 1.1l-3.5-3.25a.75.75 0 0 1 0-1.1l3.5-3.25a.75.75 0 1 1 1.02 1.1l-2.1 1.95h12.59A.75.75 0 0 1 18 10Z",clipRule:"evenodd"}))}var U=m.forwardRef(A),l=U;import{useRouter as q}from"next/navigation";function c(){let e=q();return I(()=>{document.title=`Create an admin account - ${T(process.env.NEXT_PUBLIC_APP_NAME||"","Elegant CMS")}`},[]),s.createElement("main",{className:"relative flex h-screen flex-col items-center justify-center z-10 p-4"},s.createElement("div",{className:"sm:mx-auto sm:w-full sm:max-w-md"},s.createElement(M,{className:"w-auto h-8 mx-auto"})),s.createElement(L,{className:"mt-10 w-full max-w-xl shadow-md p-0"},s.createElement("div",{className:"bg-white w-full px-6 pt-1 pb-12 sm:px-12"},s.createElement("h2",{className:"text-left text-2xl font-bold leading-9 tracking-tight text-slate-900 dark:text-slate-200"},"Create an admin account"),s.createElement("p",{className:"mt-1 mb-6 text-left text-sm leading-6 text-gray-500"},"One last step before accessing your admin panel."),s.createElement("form",{className:"space-y-6 text-left",action:async r=>{await O(r).then(o=>{e.refresh()}).catch(o=>{console.log(o)})}},s.createElement("div",null,s.createElement("label",{htmlFor:"name",className:"block text-sm font-medium leading-6 text-gray-900"},"Full name"),s.createElement("div",{className:"mt-2"},s.createElement("input",{id:"name",name:"name",type:"text",required:!0,className:"block w-full rounded-md border-0 py-1.5 px-2 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"}))),s.createElement("div",null,s.createElement("label",{htmlFor:"email",className:"block text-sm font-medium leading-6 text-gray-900"},"Email address"),s.createElement("div",{className:"mt-2"},s.createElement("input",{id:"email",name:"email",type:"email",autoComplete:"email",required:!0,className:"block w-full rounded-md border-0 py-1.5 px-2 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"}))),s.createElement("div",null,s.createElement("label",{htmlFor:"password",className:"block text-sm font-medium leading-6 text-gray-900"},"Password"),s.createElement("div",{className:"mt-2"},s.createElement("input",{id:"password",name:"password",type:"password",autoComplete:"current-password",required:!0,className:"block w-full rounded-md border-0 py-1.5 px-2 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"}))),s.createElement("div",null,s.createElement("button",{type:"submit",className:"flex w-full justify-center rounded-md bg-indigo-600 px-3 py-1.5 text-sm font-semibold leading-6 text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600"},"Create account"))))),s.createElement("div",{className:"sm:mx-auto sm:w-full max-w-xl xs:pl-0 sm:pl-4 text-left mt-10 dark:text-white"},s.createElement(j,{href:"/",className:"hover:underline"},s.createElement(l,{className:"h-6 w-6 inline mr-2"}),"Go to ",process.env.NEXT_PUBLIC_APP_NAME||"")))}async function O(e){}import i,{useEffect as B}from"react";import{Card as F,ElegantLogo as G,MetaTitle as D}from"@brandonowens/elegant-ui";import X from"next/link";function p({postgresUrl:e,nonPoolingPUrl:r}){return B(()=>{document.title=`Welcome to Elegant CMS - ${D(process.env.NEXT_PUBLIC_APP_NAME||"","Elegant CMS")}`},[]),i.createElement("main",{className:"relative flex h-screen flex-col items-center justify-center z-10 p-4"},i.createElement("div",{className:"sm:mx-auto sm:w-full sm:max-w-md"},i.createElement(G,{className:"w-auto h-8 mx-auto"})),i.createElement(F,{className:"mt-10 shadow-md"},i.createElement("div",{className:"w-full border-b border-gray-200 dark:border-slate-200 pb-5 text-left -mt-[10px]"},i.createElement("h3",{className:"text-base font-semibold leading-6 text-gray-900 dark:text-slate-200"},"Welcome to Elegant CMS")),i.createElement("p",{className:"mb-5 mt-10 text-left dark:text-slate-200"},"Before you can access your admin area, please set the following environment variables in your `.env` file:"),i.createElement("ul",{className:"mb-5"},!e&&i.createElement("li",{key:"db_url",className:"mb-1 text-left dark:text-slate-200"},"\u274C"," ",i.createElement("span",{className:"font-semibold"},"POSTGRES_PRISMA_URL")," ","is not set!"),!r&&i.createElement("li",{key:"db_url_non_pooling",className:"mb-1 text-left dark:text-slate-200"},"\u274C"," ",i.createElement("span",{className:"font-semibold"},"POSTGRES_URL_NON_POOLING")," ","is not set!")),i.createElement("p",{className:"w-full mb-5 mt-10 text-left dark:text-slate-200"},"You will need to restart Next.js to apply the changes."),i.createElement("p",{className:"w-full text-left dark:text-slate-200"},"See the ",i.createElement("a",{href:"https://www.elegantframework.com/docs/getting-started-with-elegant-cms#configuring-authentication",className:"hover:underline font-mono font-medium text-indigo-500 dark:text-indigo-400",target:"_blank"},"documentation")," for further help.")),i.createElement("div",{className:"sm:mx-auto sm:w-full max-w-2xl xs:pl-0 sm:pl-4 text-left mt-10 dark:text-white"},i.createElement(X,{href:"/",className:"hover:underline"},i.createElement(l,{className:"h-6 w-6 inline mr-2"}),"Go to ",process.env.NEXT_PUBLIC_APP_NAME||"")))}import t,{useEffect as V,useState as Z}from"react";import{Card as J,ElegantLogo as Q,MetaTitle as R}from"@brandonowens/elegant-ui";import ee from"next/link";import{useRouter as re}from"next/navigation";import K from"next-auth";var v={pages:{signIn:"/admin",verifyRequest:"/admin",error:"/admin"},session:{strategy:"jwt"},providers:[],callbacks:{jwt({token:e,user:r}){return r&&(e.id=r.id),e},session({session:e,token:r}){return e.user.id=r.id,e}}};import W from"next-auth/providers/github";import z from"next-auth/providers/credentials";import{z as $,string as N}from"zod";import H from"bcryptjs";function h(e,r){return H.compareSync(e,r)}var{handlers:Ue,auth:Ie,signIn:b,signOut:Le}=K({...v,providers:[W({clientId:process.env.AUTH_GITHUB_ID,clientSecret:process.env.AUTH_GITHUB_SECRET,profile(e){return{id:e.id.toString(),name:e.name||e.login,gh_username:e.login,email:e.email,image:e.avatar_url}}}),z({credentials:{email:{},password:{}},authorize:async e=>{let r=$.object({email:N({required_error:"Email is required"}).min(1,"Email is required").email("Invalid email"),password:N({required_error:"Password is required"}).min(1,"Password is required").min(6,"Password must be more than 6 characters").max(32,"Password must be less than 32 characters")}).safeParse(e);if(r.success){let{email:o,password:n}=r.data,a=await y(o);if(!a)return null;let d=h(n,a.password);if(!d)throw new Error("User not found.");if(d)return{id:a.id,name:a.name,email:a.email,image:a.image}}return null}})]});import{PrismaClient as Y}from"@prisma/client";var C=global.prisma||new Y;process.env.NODE_ENV==="development"&&(global.prisma=C);var f=C;async function y(e){return await f.user.findUnique({where:{email:e}})}async function P(){return(await f.user.findMany({where:{role:"admin"}})).length}async function E(e){try{return await b("credentials",e)}catch(r){return{error:r.message}}}import{XCircleIcon as te}from"lucide-react";function g(){let e=re(),[r,o]=Z("");return e.replace("/admin"),V(()=>{document.title=`Log In - ${R(process.env.NEXT_PUBLIC_APP_NAME||"","Elegant CMS")}`},[]),t.createElement("main",{className:"relative flex h-screen flex-col items-center justify-center z-10 p-0 md:p-4"},t.createElement("div",{className:"mr-3 flex-none w-[2.0625rem] overflow-hidden"},t.createElement(Q,{className:"w-auto h-8 mx-auto"})),t.createElement("div",{className:"sm:mx-auto sm:w-full sm:max-w-md"},t.createElement("h2",{className:"mt-6 text-center text-2xl font-bold leading-9 tracking-tight text-slate-900 dark:text-slate-200"},"Sign in to your account")),t.createElement(J,{className:"mt-10 w-full max-w-xl shadow-md p-0"},t.createElement("div",{className:"w-full px-6 py-4 sm:px-12"},r.length>0&&t.createElement("div",{className:"rounded-md bg-red-50 p-4 mb-6"},t.createElement("div",{className:"flex"},t.createElement("div",{className:"flex-shrink-0"},t.createElement(te,{className:"h-5 w-5 text-red-400","aria-hidden":"true"})),t.createElement("div",{className:"ml-3"},t.createElement("h3",{className:"text-sm font-medium text-red-800"},r)))),t.createElement("form",{className:"space-y-6 text-left",action:async n=>{let a=n.get("email"),d=n.get("password");o(""),await E({email:a,password:d}).then(k=>{k.error.includes("Read more at ")?o("Invalid email or password."):e.refresh()})}},t.createElement("div",null,t.createElement("label",{htmlFor:"email",className:"block text-sm font-medium leading-6 text-gray-900"},"Email address"),t.createElement("div",{className:"mt-2"},t.createElement("input",{id:"email",name:"email",type:"email",autoComplete:"email",required:!0,className:"block w-full rounded-md border-0 py-1.5 px-2 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"}))),t.createElement("div",null,t.createElement("label",{htmlFor:"password",className:"block text-sm font-medium leading-6 text-gray-900"},"Password"),t.createElement("div",{className:"mt-2"},t.createElement("input",{id:"password",name:"password",type:"password",autoComplete:"current-password",required:!0,className:"block w-full rounded-md border-0 py-1.5 px-2 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"}))),t.createElement("div",{className:"flex items-center justify-between"},t.createElement("div",{className:"flex items-center"}),t.createElement("div",{className:"text-sm leading-6"})),t.createElement("div",null,t.createElement("button",{type:"submit",className:"flex w-full justify-center rounded-md bg-indigo-600 px-3 py-1.5 text-sm font-semibold leading-6 text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600"},"Sign in"))))),t.createElement("div",{className:"sm:mx-auto sm:w-full max-w-xl xs:pl-0 sm:pl-4 text-left mt-10 dark:text-white"},t.createElement(ee,{href:"/",className:"hover:underline"},t.createElement(l,{className:"h-6 w-6 inline mr-2"}),"Go to ",process.env.NEXT_PUBLIC_APP_NAME||"")))}function w({postgresUrl:e,nonPoolingPUrl:r,adminCount:o,session:n,params:a}){if(!e||!r)return x.createElement(p,{postgresUrl:e,nonPoolingPUrl:r});if(o===0)return x.createElement(c,null);if(!n)return x.createElement(g,null)}async function _({postgresUrl:e,nonPoolingPUrl:r,params:o}){let n=await P();return console.log(n),se.createElement(w,{postgresUrl:e,nonPoolingPUrl:r,adminCount:n,session:null,params:o})}import{PutObjectCommand as oe}from"@aws-sdk/client-s3";import{getSignedUrl as ne}from"@aws-sdk/s3-request-presigner";import{S3Client as ie}from"@aws-sdk/client-s3";function u(e,r,o){return new ie({region:"auto",endpoint:`https://${e}.r2.cloudflarestorage.com`,credentials:{accessKeyId:r,secretAccessKey:o}})}import{NextResponse as ae}from"next/server";async function S(e){let r=await ne(u(process.env.R2_ACCOUNT_ID||"",process.env.R2_ACCESS_KEY_ID||"",process.env.R2_SECRET_ACCESS_KEY||""),new oe({Bucket:process.env.R2_BUCKET_NAME,ContentType:e.type,Key:e.name}),{expiresIn:60});return ae.json({url:r})}export{_ as CMS,S as R2,u as S3Client};
//# sourceMappingURL=index.mjs.map