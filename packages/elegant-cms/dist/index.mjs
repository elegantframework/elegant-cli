import z from"react";import g from"react";import r,{useEffect as E}from"react";import{Card as S,ElegantLogo as A,MetaTitle as U}from"@brandonowens/elegant-ui";import k from"next/link";import*as a from"react";function P({title:e,titleId:t,...n},i){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:i,"aria-labelledby":t},n),e?a.createElement("title",{id:t},e):null,a.createElement("path",{fillRule:"evenodd",d:"M18 10a.75.75 0 0 1-.75.75H4.66l2.1 1.95a.75.75 0 1 1-1.02 1.1l-3.5-3.25a.75.75 0 0 1 0-1.1l3.5-3.25a.75.75 0 1 1 1.02 1.1l-2.1 1.95h12.59A.75.75 0 0 1 18 10Z",clipRule:"evenodd"}))}var _=a.forwardRef(P),m=_;import{useRouter as I}from"next/navigation";function d(){let e=I();return E(()=>{document.title=`Create an admin account - ${U(process.env.NEXT_PUBLIC_APP_NAME||"","Elegant CMS")}`},[]),r.createElement("main",{className:"relative flex h-screen flex-col items-center justify-center z-10 p-4"},r.createElement("div",{className:"sm:mx-auto sm:w-full sm:max-w-md"},r.createElement(A,{className:"w-auto h-8 mx-auto"})),r.createElement(S,{className:"mt-10 w-full max-w-xl shadow-md p-0"},r.createElement("div",{className:"bg-white w-full px-6 pt-1 pb-12 sm:px-12"},r.createElement("h2",{className:"text-left text-2xl font-bold leading-9 tracking-tight text-slate-900 dark:text-slate-200"},"Create an admin account"),r.createElement("p",{className:"mt-1 mb-6 text-left text-sm leading-6 text-gray-500"},"One last step before accessing your admin panel."),r.createElement("form",{className:"space-y-6 text-left",action:async t=>{await L(t).then(n=>{e.refresh()}).catch(n=>{console.log(n)})}},r.createElement("div",null,r.createElement("label",{htmlFor:"name",className:"block text-sm font-medium leading-6 text-gray-900"},"Full name"),r.createElement("div",{className:"mt-2"},r.createElement("input",{id:"name",name:"name",type:"text",required:!0,className:"block w-full rounded-md border-0 py-1.5 px-2 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"}))),r.createElement("div",null,r.createElement("label",{htmlFor:"email",className:"block text-sm font-medium leading-6 text-gray-900"},"Email address"),r.createElement("div",{className:"mt-2"},r.createElement("input",{id:"email",name:"email",type:"email",autoComplete:"email",required:!0,className:"block w-full rounded-md border-0 py-1.5 px-2 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"}))),r.createElement("div",null,r.createElement("label",{htmlFor:"password",className:"block text-sm font-medium leading-6 text-gray-900"},"Password"),r.createElement("div",{className:"mt-2"},r.createElement("input",{id:"password",name:"password",type:"password",autoComplete:"current-password",required:!0,className:"block w-full rounded-md border-0 py-1.5 px-2 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"}))),r.createElement("div",null,r.createElement("button",{type:"submit",className:"flex w-full justify-center rounded-md bg-indigo-600 px-3 py-1.5 text-sm font-semibold leading-6 text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600"},"Create account"))))),r.createElement("div",{className:"sm:mx-auto sm:w-full max-w-xl xs:pl-0 sm:pl-4 text-left mt-10 dark:text-white"},r.createElement(k,{href:"/",className:"hover:underline"},r.createElement(m,{className:"h-6 w-6 inline mr-2"}),"Go to ",process.env.NEXT_PUBLIC_APP_NAME||"")))}async function L(e){}import s,{useEffect as M}from"react";import{Card as T,ElegantLogo as O,MetaTitle as q}from"@brandonowens/elegant-ui";import j from"next/link";function u({postgresUrl:e,nonPoolingPUrl:t}){return M(()=>{document.title=`Welcome to Elegant CMS - ${q(process.env.NEXT_PUBLIC_APP_NAME||"","Elegant CMS")}`},[]),s.createElement("main",{className:"relative flex h-screen flex-col items-center justify-center z-10 p-4"},s.createElement("div",{className:"sm:mx-auto sm:w-full sm:max-w-md"},s.createElement(O,{className:"w-auto h-8 mx-auto"})),s.createElement(T,{className:"mt-10 shadow-md"},s.createElement("div",{className:"w-full border-b border-gray-200 dark:border-slate-200 pb-5 text-left -mt-[10px]"},s.createElement("h3",{className:"text-base font-semibold leading-6 text-gray-900 dark:text-slate-200"},"Welcome to Elegant CMS")),s.createElement("p",{className:"mb-5 mt-10 text-left dark:text-slate-200"},"Before you can access your admin area, please set the following environment variables in your `.env` file:"),s.createElement("ul",{className:"mb-5"},!e&&s.createElement("li",{key:"db_url",className:"mb-1 text-left dark:text-slate-200"},"\u274C"," ",s.createElement("span",{className:"font-semibold"},"POSTGRES_PRISMA_URL")," ","is not set!"),!t&&s.createElement("li",{key:"db_url_non_pooling",className:"mb-1 text-left dark:text-slate-200"},"\u274C"," ",s.createElement("span",{className:"font-semibold"},"POSTGRES_URL_NON_POOLING")," ","is not set!")),s.createElement("p",{className:"w-full mb-5 mt-10 text-left dark:text-slate-200"},"You will need to restart Next.js to apply the changes."),s.createElement("p",{className:"w-full text-left dark:text-slate-200"},"See the ",s.createElement("a",{href:"https://www.elegantframework.com/docs/getting-started-with-elegant-cms#configuring-authentication",className:"hover:underline font-mono font-medium text-indigo-500 dark:text-indigo-400",target:"_blank"},"documentation")," for further help.")),s.createElement("div",{className:"sm:mx-auto sm:w-full max-w-2xl xs:pl-0 sm:pl-4 text-left mt-10 dark:text-white"},s.createElement(j,{href:"/",className:"hover:underline"},s.createElement(m,{className:"h-6 w-6 inline mr-2"}),"Go to ",process.env.NEXT_PUBLIC_APP_NAME||"")))}function c({postgresUrl:e,nonPoolingPUrl:t,adminCount:n,session:i,params:o}){if(!e||!t)return g.createElement(u,{postgresUrl:e,nonPoolingPUrl:t});if(n===0)return g.createElement(d,null)}import F from"next-auth";var x={pages:{signIn:"/admin",verifyRequest:"/admin",error:"/admin"},session:{strategy:"jwt"},providers:[],callbacks:{jwt({token:e,user:t}){return t&&(e.id=t.id),e},session({session:e,token:t}){return e.user.id=t.id,e}}};import G from"next-auth/providers/github";import D from"next-auth/providers/credentials";import{z as H,string as h}from"zod";import B from"bcryptjs";function w(e,t){return B.compareSync(e,t)}var{handlers:Ne,auth:Ce,signIn:K,signOut:Pe}=F({...x,providers:[G({clientId:process.env.AUTH_GITHUB_ID,clientSecret:process.env.AUTH_GITHUB_SECRET,profile(e){return{id:e.id.toString(),name:e.name||e.login,gh_username:e.login,email:e.email,image:e.avatar_url}}}),D({credentials:{email:{},password:{}},authorize:async e=>{let t=H.object({email:h({required_error:"Email is required"}).min(1,"Email is required").email("Invalid email"),password:h({required_error:"Password is required"}).min(1,"Password is required").min(6,"Password must be more than 6 characters").max(32,"Password must be less than 32 characters")}).safeParse(e);if(t.success){let{email:n,password:i}=t.data,o=await v(n);if(!o)return null;let f=w(i,o.password);if(!f)throw new Error("User not found.");if(f)return{id:o.id,name:o.name,email:o.email,image:o.image}}return null}})]});import{PrismaClient as W}from"@prisma/client";var b=global.prisma||new W;process.env.NODE_ENV==="development"&&(global.prisma=b);var p=b;async function v(e){return await p.user.findUnique({where:{email:e}})}async function y(){return(await p.user.findMany({where:{role:"admin"}})).length}async function N({postgresUrl:e,nonPoolingPUrl:t,params:n}){let i=await y();return z.createElement(c,{postgresUrl:e,nonPoolingPUrl:t,adminCount:0,session:null,params:n})}import{PutObjectCommand as Y}from"@aws-sdk/client-s3";import{getSignedUrl as $}from"@aws-sdk/s3-request-presigner";import{S3Client as X}from"@aws-sdk/client-s3";function l(e,t,n){return new X({region:"auto",endpoint:`https://${e}.r2.cloudflarestorage.com`,credentials:{accessKeyId:t,secretAccessKey:n}})}import{NextResponse as V}from"next/server";async function C(e){let t=await $(l(process.env.R2_ACCOUNT_ID||"",process.env.R2_ACCESS_KEY_ID||"",process.env.R2_SECRET_ACCESS_KEY||""),new Y({Bucket:process.env.R2_BUCKET_NAME,ContentType:e.type,Key:e.name}),{expiresIn:60});return V.json({url:t})}export{N as CMS,C as R2,l as S3Client};
//# sourceMappingURL=index.mjs.map