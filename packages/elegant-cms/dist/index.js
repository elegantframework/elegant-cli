"use client";var H=Object.create;var p=Object.defineProperty;var K=Object.getOwnPropertyDescriptor;var W=Object.getOwnPropertyNames;var z=Object.getPrototypeOf,X=Object.prototype.hasOwnProperty;var Y=(e,t)=>{for(var s in t)p(e,s,{get:t[s],enumerable:!0})},C=(e,t,s,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of W(t))!X.call(e,o)&&o!==s&&p(e,o,{get:()=>t[o],enumerable:!(i=K(t,o))||i.enumerable});return e};var a=(e,t,s)=>(s=e!=null?H(z(e)):{},C(t||!e||!e.__esModule?p(s,"default",{value:e,enumerable:!0}):s,e)),$=e=>C(p({},"__esModule",{value:!0}),e);var R={};Y(R,{CMS:()=>b,R2:()=>y,S3Client:()=>c});module.exports=$(R);var j=a(require("react"));var w=a(require("react"));var r=a(require("react")),l=require("@brandonowens/elegant-ui"),P=a(require("next/link"));var m=a(require("react"),1);function V({title:e,titleId:t,...s},i){return m.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:i,"aria-labelledby":t},s),e?m.createElement("title",{id:t},e):null,m.createElement("path",{fillRule:"evenodd",d:"M18 10a.75.75 0 0 1-.75.75H4.66l2.1 1.95a.75.75 0 1 1-1.02 1.1l-3.5-3.25a.75.75 0 0 1 0-1.1l3.5-3.25a.75.75 0 1 1 1.02 1.1l-2.1 1.95h12.59A.75.75 0 0 1 18 10Z",clipRule:"evenodd"}))}var Z=m.forwardRef(V),f=Z;var _=require("next/navigation");function g(){let e=(0,_.useRouter)();return(0,r.useEffect)(()=>{document.title=`Create an admin account - ${(0,l.MetaTitle)(process.env.NEXT_PUBLIC_APP_NAME||"","Elegant CMS")}`},[]),r.default.createElement("main",{className:"relative flex h-screen flex-col items-center justify-center z-10 p-4"},r.default.createElement("div",{className:"sm:mx-auto sm:w-full sm:max-w-md"},r.default.createElement(l.ElegantLogo,{className:"w-auto h-8 mx-auto"})),r.default.createElement(l.Card,{className:"mt-10 w-full max-w-xl shadow-md p-0"},r.default.createElement("div",{className:"bg-white w-full px-6 pt-1 pb-12 sm:px-12"},r.default.createElement("h2",{className:"text-left text-2xl font-bold leading-9 tracking-tight text-slate-900 dark:text-slate-200"},"Create an admin account"),r.default.createElement("p",{className:"mt-1 mb-6 text-left text-sm leading-6 text-gray-500"},"One last step before accessing your admin panel."),r.default.createElement("form",{className:"space-y-6 text-left",action:async t=>{await J(t).then(s=>{e.refresh()}).catch(s=>{console.log(s)})}},r.default.createElement("div",null,r.default.createElement("label",{htmlFor:"name",className:"block text-sm font-medium leading-6 text-gray-900"},"Full name"),r.default.createElement("div",{className:"mt-2"},r.default.createElement("input",{id:"name",name:"name",type:"text",required:!0,className:"block w-full rounded-md border-0 py-1.5 px-2 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"}))),r.default.createElement("div",null,r.default.createElement("label",{htmlFor:"email",className:"block text-sm font-medium leading-6 text-gray-900"},"Email address"),r.default.createElement("div",{className:"mt-2"},r.default.createElement("input",{id:"email",name:"email",type:"email",autoComplete:"email",required:!0,className:"block w-full rounded-md border-0 py-1.5 px-2 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"}))),r.default.createElement("div",null,r.default.createElement("label",{htmlFor:"password",className:"block text-sm font-medium leading-6 text-gray-900"},"Password"),r.default.createElement("div",{className:"mt-2"},r.default.createElement("input",{id:"password",name:"password",type:"password",autoComplete:"current-password",required:!0,className:"block w-full rounded-md border-0 py-1.5 px-2 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"}))),r.default.createElement("div",null,r.default.createElement("button",{type:"submit",className:"flex w-full justify-center rounded-md bg-indigo-600 px-3 py-1.5 text-sm font-semibold leading-6 text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600"},"Create account"))))),r.default.createElement("div",{className:"sm:mx-auto sm:w-full max-w-xl xs:pl-0 sm:pl-4 text-left mt-10 dark:text-white"},r.default.createElement(P.default,{href:"/",className:"hover:underline"},r.default.createElement(f,{className:"h-6 w-6 inline mr-2"}),"Go to ",process.env.NEXT_PUBLIC_APP_NAME||"")))}async function J(e){}var n=a(require("react")),d=require("@brandonowens/elegant-ui"),E=a(require("next/link"));function x({postgresUrl:e,nonPoolingPUrl:t}){return(0,n.useEffect)(()=>{document.title=`Welcome to Elegant CMS - ${(0,d.MetaTitle)(process.env.NEXT_PUBLIC_APP_NAME||"","Elegant CMS")}`},[]),n.default.createElement("main",{className:"relative flex h-screen flex-col items-center justify-center z-10 p-4"},n.default.createElement("div",{className:"sm:mx-auto sm:w-full sm:max-w-md"},n.default.createElement(d.ElegantLogo,{className:"w-auto h-8 mx-auto"})),n.default.createElement(d.Card,{className:"mt-10 shadow-md"},n.default.createElement("div",{className:"w-full border-b border-gray-200 dark:border-slate-200 pb-5 text-left -mt-[10px]"},n.default.createElement("h3",{className:"text-base font-semibold leading-6 text-gray-900 dark:text-slate-200"},"Welcome to Elegant CMS")),n.default.createElement("p",{className:"mb-5 mt-10 text-left dark:text-slate-200"},"Before you can access your admin area, please set the following environment variables in your `.env` file:"),n.default.createElement("ul",{className:"mb-5"},!e&&n.default.createElement("li",{key:"db_url",className:"mb-1 text-left dark:text-slate-200"},"\u274C"," ",n.default.createElement("span",{className:"font-semibold"},"POSTGRES_PRISMA_URL")," ","is not set!"),!t&&n.default.createElement("li",{key:"db_url_non_pooling",className:"mb-1 text-left dark:text-slate-200"},"\u274C"," ",n.default.createElement("span",{className:"font-semibold"},"POSTGRES_URL_NON_POOLING")," ","is not set!")),n.default.createElement("p",{className:"w-full mb-5 mt-10 text-left dark:text-slate-200"},"You will need to restart Next.js to apply the changes."),n.default.createElement("p",{className:"w-full text-left dark:text-slate-200"},"See the ",n.default.createElement("a",{href:"https://www.elegantframework.com/docs/getting-started-with-elegant-cms#configuring-authentication",className:"hover:underline font-mono font-medium text-indigo-500 dark:text-indigo-400",target:"_blank"},"documentation")," for further help.")),n.default.createElement("div",{className:"sm:mx-auto sm:w-full max-w-2xl xs:pl-0 sm:pl-4 text-left mt-10 dark:text-white"},n.default.createElement(E.default,{href:"/",className:"hover:underline"},n.default.createElement(f,{className:"h-6 w-6 inline mr-2"}),"Go to ",process.env.NEXT_PUBLIC_APP_NAME||"")))}function h({postgresUrl:e,nonPoolingPUrl:t,adminCount:s,session:i,params:o}){if(!e||!t)return w.default.createElement(x,{postgresUrl:e,nonPoolingPUrl:t});if(s===0)return w.default.createElement(g,null)}var k=a(require("next-auth"));var S={pages:{signIn:"/admin",verifyRequest:"/admin",error:"/admin"},session:{strategy:"jwt"},providers:[],callbacks:{jwt({token:e,user:t}){return t&&(e.id=t.id),e},session({session:e,token:t}){return e.user.id=t.id,e}}};var I=a(require("next-auth/providers/github")),L=a(require("next-auth/providers/credentials")),u=require("zod");var A=a(require("bcryptjs"));function U(e,t){return A.default.compareSync(e,t)}var{handlers:fe,auth:ge,signIn:Q,signOut:xe}=(0,k.default)({...S,providers:[(0,I.default)({clientId:process.env.AUTH_GITHUB_ID,clientSecret:process.env.AUTH_GITHUB_SECRET,profile(e){return{id:e.id.toString(),name:e.name||e.login,gh_username:e.login,email:e.email,image:e.avatar_url}}}),(0,L.default)({credentials:{email:{},password:{}},authorize:async e=>{let t=u.z.object({email:(0,u.string)({required_error:"Email is required"}).min(1,"Email is required").email("Invalid email"),password:(0,u.string)({required_error:"Password is required"}).min(1,"Password is required").min(6,"Password must be more than 6 characters").max(32,"Password must be less than 32 characters")}).safeParse(e);if(t.success){let{email:s,password:i}=t.data,o=await M(s);if(!o)return null;let N=U(i,o.password);if(!N)throw new Error("User not found.");if(N)return{id:o.id,name:o.name,email:o.email,image:o.image}}return null}})]});var T=require("@prisma/client"),O=global.prisma||new T.PrismaClient;process.env.NODE_ENV==="development"&&(global.prisma=O);var v=O;async function M(e){return await v.user.findUnique({where:{email:e}})}async function q(){return(await v.user.findMany({where:{role:"admin"}})).length}async function b({postgresUrl:e,nonPoolingPUrl:t,params:s}){let i=await q();return j.default.createElement(h,{postgresUrl:e,nonPoolingPUrl:t,adminCount:0,session:null,params:s})}var F=require("@aws-sdk/client-s3"),G=require("@aws-sdk/s3-request-presigner");var B=require("@aws-sdk/client-s3");function c(e,t,s){return new B.S3Client({region:"auto",endpoint:`https://${e}.r2.cloudflarestorage.com`,credentials:{accessKeyId:t,secretAccessKey:s}})}var D=require("next/server");async function y(e){let t=await(0,G.getSignedUrl)(c(process.env.R2_ACCOUNT_ID||"",process.env.R2_ACCESS_KEY_ID||"",process.env.R2_SECRET_ACCESS_KEY||""),new F.PutObjectCommand({Bucket:process.env.R2_BUCKET_NAME,ContentType:e.type,Key:e.name}),{expiresIn:60});return D.NextResponse.json({url:t})}0&&(module.exports={CMS,R2,S3Client});
//# sourceMappingURL=index.js.map