"use client"
"use strict";var J=Object.create;var w=Object.defineProperty;var Q=Object.getOwnPropertyDescriptor;var R=Object.getOwnPropertyNames;var ee=Object.getPrototypeOf,re=Object.prototype.hasOwnProperty;var te=(e,r)=>{for(var i in r)w(e,i,{get:r[i],enumerable:!0})},_=(e,r,i,a)=>{if(r&&typeof r=="object"||typeof r=="function")for(let n of R(r))!re.call(e,n)&&n!==i&&w(e,n,{get:()=>r[n],enumerable:!(a=Q(r,n))||a.enumerable});return e};var m=(e,r,i)=>(i=e!=null?J(ee(e)):{},_(r||!e||!e.__esModule?w(i,"default",{value:e,enumerable:!0}):i,e)),se=e=>_(w({},"__esModule",{value:!0}),e);var ae={};te(ae,{CMS:()=>P,R2:()=>E,S3Client:()=>g});module.exports=se(ae);var W=m(require("react"));var v=m(require("react"));var s=m(require("react")),u=require("@brandonowens/elegant-ui"),S=m(require("next/link"));var l=m(require("react"),1);function ie({title:e,titleId:r,...i},a){return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":r},i),e?l.createElement("title",{id:r},e):null,l.createElement("path",{fillRule:"evenodd",d:"M18 10a.75.75 0 0 1-.75.75H4.66l2.1 1.95a.75.75 0 1 1-1.02 1.1l-3.5-3.25a.75.75 0 0 1 0-1.1l3.5-3.25a.75.75 0 1 1 1.02 1.1l-2.1 1.95h12.59A.75.75 0 0 1 18 10Z",clipRule:"evenodd"}))}var oe=l.forwardRef(ie),d=oe;var k=require("next/navigation");function h(){let e=(0,k.useRouter)();return(0,s.useEffect)(()=>{document.title=`Create an admin account - ${(0,u.MetaTitle)(process.env.NEXT_PUBLIC_APP_NAME||"","Elegant CMS")}`},[]),s.default.createElement("main",{className:"relative flex h-screen flex-col items-center justify-center z-10 p-4"},s.default.createElement("div",{className:"sm:mx-auto sm:w-full sm:max-w-md"},s.default.createElement(u.ElegantLogo,{className:"w-auto h-8 mx-auto"})),s.default.createElement(u.Card,{className:"mt-10 w-full max-w-xl shadow-md p-0"},s.default.createElement("div",{className:"bg-white w-full px-6 pt-1 pb-12 sm:px-12"},s.default.createElement("h2",{className:"text-left text-2xl font-bold leading-9 tracking-tight text-slate-900 dark:text-slate-200"},"Create an admin account"),s.default.createElement("p",{className:"mt-1 mb-6 text-left text-sm leading-6 text-gray-500"},"One last step before accessing your admin panel."),s.default.createElement("form",{className:"space-y-6 text-left",action:async r=>{await ne(r).then(i=>{e.refresh()}).catch(i=>{console.log(i)})}},s.default.createElement("div",null,s.default.createElement("label",{htmlFor:"name",className:"block text-sm font-medium leading-6 text-gray-900"},"Full name"),s.default.createElement("div",{className:"mt-2"},s.default.createElement("input",{id:"name",name:"name",type:"text",required:!0,className:"block w-full rounded-md border-0 py-1.5 px-2 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"}))),s.default.createElement("div",null,s.default.createElement("label",{htmlFor:"email",className:"block text-sm font-medium leading-6 text-gray-900"},"Email address"),s.default.createElement("div",{className:"mt-2"},s.default.createElement("input",{id:"email",name:"email",type:"email",autoComplete:"email",required:!0,className:"block w-full rounded-md border-0 py-1.5 px-2 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"}))),s.default.createElement("div",null,s.default.createElement("label",{htmlFor:"password",className:"block text-sm font-medium leading-6 text-gray-900"},"Password"),s.default.createElement("div",{className:"mt-2"},s.default.createElement("input",{id:"password",name:"password",type:"password",autoComplete:"current-password",required:!0,className:"block w-full rounded-md border-0 py-1.5 px-2 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"}))),s.default.createElement("div",null,s.default.createElement("button",{type:"submit",className:"flex w-full justify-center rounded-md bg-indigo-600 px-3 py-1.5 text-sm font-semibold leading-6 text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600"},"Create account"))))),s.default.createElement("div",{className:"sm:mx-auto sm:w-full max-w-xl xs:pl-0 sm:pl-4 text-left mt-10 dark:text-white"},s.default.createElement(S.default,{href:"/",className:"hover:underline"},s.default.createElement(d,{className:"h-6 w-6 inline mr-2"}),"Go to ",process.env.NEXT_PUBLIC_APP_NAME||"")))}async function ne(e){}var o=m(require("react")),c=require("@brandonowens/elegant-ui"),A=m(require("next/link"));function N({postgresUrl:e,nonPoolingPUrl:r}){return(0,o.useEffect)(()=>{document.title=`Welcome to Elegant CMS - ${(0,c.MetaTitle)(process.env.NEXT_PUBLIC_APP_NAME||"","Elegant CMS")}`},[]),o.default.createElement("main",{className:"relative flex h-screen flex-col items-center justify-center z-10 p-4"},o.default.createElement("div",{className:"sm:mx-auto sm:w-full sm:max-w-md"},o.default.createElement(c.ElegantLogo,{className:"w-auto h-8 mx-auto"})),o.default.createElement(c.Card,{className:"mt-10 shadow-md"},o.default.createElement("div",{className:"w-full border-b border-gray-200 dark:border-slate-200 pb-5 text-left -mt-[10px]"},o.default.createElement("h3",{className:"text-base font-semibold leading-6 text-gray-900 dark:text-slate-200"},"Welcome to Elegant CMS")),o.default.createElement("p",{className:"mb-5 mt-10 text-left dark:text-slate-200"},"Before you can access your admin area, please set the following environment variables in your `.env` file:"),o.default.createElement("ul",{className:"mb-5"},!e&&o.default.createElement("li",{key:"db_url",className:"mb-1 text-left dark:text-slate-200"},"\u274C"," ",o.default.createElement("span",{className:"font-semibold"},"POSTGRES_PRISMA_URL")," ","is not set!"),!r&&o.default.createElement("li",{key:"db_url_non_pooling",className:"mb-1 text-left dark:text-slate-200"},"\u274C"," ",o.default.createElement("span",{className:"font-semibold"},"POSTGRES_URL_NON_POOLING")," ","is not set!")),o.default.createElement("p",{className:"w-full mb-5 mt-10 text-left dark:text-slate-200"},"You will need to restart Next.js to apply the changes."),o.default.createElement("p",{className:"w-full text-left dark:text-slate-200"},"See the ",o.default.createElement("a",{href:"https://www.elegantframework.com/docs/getting-started-with-elegant-cms#configuring-authentication",className:"hover:underline font-mono font-medium text-indigo-500 dark:text-indigo-400",target:"_blank"},"documentation")," for further help.")),o.default.createElement("div",{className:"sm:mx-auto sm:w-full max-w-2xl xs:pl-0 sm:pl-4 text-left mt-10 dark:text-white"},o.default.createElement(A.default,{href:"/",className:"hover:underline"},o.default.createElement(d,{className:"h-6 w-6 inline mr-2"}),"Go to ",process.env.NEXT_PUBLIC_APP_NAME||"")))}var t=m(require("react")),p=require("@brandonowens/elegant-ui"),X=m(require("next/link"));var H=require("next/navigation");var M=m(require("next-auth"));var U={pages:{signIn:"/admin",verifyRequest:"/admin",error:"/admin"},session:{strategy:"jwt"},providers:[],callbacks:{jwt({token:e,user:r}){return r&&(e.id=r.id),e},session({session:e,token:r}){return e.user.id=r.id,e}}};var T=m(require("next-auth/providers/github")),j=m(require("next-auth/providers/credentials")),f=require("zod");var I=m(require("bcryptjs"));function L(e,r){return I.default.compareSync(e,r)}var{handlers:he,auth:Ne,signIn:q,signOut:be}=(0,M.default)({...U,providers:[(0,T.default)({clientId:process.env.AUTH_GITHUB_ID,clientSecret:process.env.AUTH_GITHUB_SECRET,profile(e){return{id:e.id.toString(),name:e.name||e.login,gh_username:e.login,email:e.email,image:e.avatar_url}}}),(0,j.default)({credentials:{email:{},password:{}},authorize:async e=>{let r=f.z.object({email:(0,f.string)({required_error:"Email is required"}).min(1,"Email is required").email("Invalid email"),password:(0,f.string)({required_error:"Password is required"}).min(1,"Password is required").min(6,"Password must be more than 6 characters").max(32,"Password must be less than 32 characters")}).safeParse(e);if(r.success){let{email:i,password:a}=r.data,n=await O(i);if(!n)return null;let x=L(a,n.password);if(!x)throw new Error("User not found.");if(x)return{id:n.id,name:n.name,email:n.email,image:n.image}}return null}})]});var B=require("@prisma/client"),F=global.prisma||new B.PrismaClient;process.env.NODE_ENV==="development"&&(global.prisma=F);var b=F;async function O(e){return await b.user.findUnique({where:{email:e}})}async function G(){return(await b.user.findMany({where:{role:"admin"}})).length}async function D(e){try{return await q("credentials",e)}catch(r){return{error:r.message}}}var K=require("lucide-react");function y(){let e=(0,H.useRouter)(),[r,i]=(0,t.useState)("");return e.replace("/admin"),(0,t.useEffect)(()=>{document.title=`Log In - ${(0,p.MetaTitle)(process.env.NEXT_PUBLIC_APP_NAME||"","Elegant CMS")}`},[]),t.default.createElement("main",{className:"relative flex h-screen flex-col items-center justify-center z-10 p-0 md:p-4"},t.default.createElement("div",{className:"mr-3 flex-none w-[2.0625rem] overflow-hidden"},t.default.createElement(p.ElegantLogo,{className:"w-auto h-8 mx-auto"})),t.default.createElement("div",{className:"sm:mx-auto sm:w-full sm:max-w-md"},t.default.createElement("h2",{className:"mt-6 text-center text-2xl font-bold leading-9 tracking-tight text-slate-900 dark:text-slate-200"},"Sign in to your account")),t.default.createElement(p.Card,{className:"mt-10 w-full max-w-xl shadow-md p-0"},t.default.createElement("div",{className:"w-full px-6 py-4 sm:px-12"},r.length>0&&t.default.createElement("div",{className:"rounded-md bg-red-50 p-4 mb-6"},t.default.createElement("div",{className:"flex"},t.default.createElement("div",{className:"flex-shrink-0"},t.default.createElement(K.XCircleIcon,{className:"h-5 w-5 text-red-400","aria-hidden":"true"})),t.default.createElement("div",{className:"ml-3"},t.default.createElement("h3",{className:"text-sm font-medium text-red-800"},r)))),t.default.createElement("form",{className:"space-y-6 text-left",action:async a=>{let n=a.get("email"),x=a.get("password");i(""),await D({email:n,password:x}).then(Z=>{Z.error.includes("Read more at ")?i("Invalid email or password."):e.refresh()})}},t.default.createElement("div",null,t.default.createElement("label",{htmlFor:"email",className:"block text-sm font-medium leading-6 text-gray-900"},"Email address"),t.default.createElement("div",{className:"mt-2"},t.default.createElement("input",{id:"email",name:"email",type:"email",autoComplete:"email",required:!0,className:"block w-full rounded-md border-0 py-1.5 px-2 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"}))),t.default.createElement("div",null,t.default.createElement("label",{htmlFor:"password",className:"block text-sm font-medium leading-6 text-gray-900"},"Password"),t.default.createElement("div",{className:"mt-2"},t.default.createElement("input",{id:"password",name:"password",type:"password",autoComplete:"current-password",required:!0,className:"block w-full rounded-md border-0 py-1.5 px-2 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"}))),t.default.createElement("div",{className:"flex items-center justify-between"},t.default.createElement("div",{className:"flex items-center"}),t.default.createElement("div",{className:"text-sm leading-6"})),t.default.createElement("div",null,t.default.createElement("button",{type:"submit",className:"flex w-full justify-center rounded-md bg-indigo-600 px-3 py-1.5 text-sm font-semibold leading-6 text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600"},"Sign in"))))),t.default.createElement("div",{className:"sm:mx-auto sm:w-full max-w-xl xs:pl-0 sm:pl-4 text-left mt-10 dark:text-white"},t.default.createElement(X.default,{href:"/",className:"hover:underline"},t.default.createElement(d,{className:"h-6 w-6 inline mr-2"}),"Go to ",process.env.NEXT_PUBLIC_APP_NAME||"")))}function C({postgresUrl:e,nonPoolingPUrl:r,adminCount:i,session:a,params:n}){if(!e||!r)return v.default.createElement(N,{postgresUrl:e,nonPoolingPUrl:r});if(i===0)return v.default.createElement(h,null);if(!a)return v.default.createElement(y,null)}async function P({postgresUrl:e,nonPoolingPUrl:r,params:i}){let a=await G();return console.log(a),W.default.createElement(C,{postgresUrl:e,nonPoolingPUrl:r,adminCount:a,session:null,params:i})}var $=require("@aws-sdk/client-s3"),Y=require("@aws-sdk/s3-request-presigner");var z=require("@aws-sdk/client-s3");function g(e,r,i){return new z.S3Client({region:"auto",endpoint:`https://${e}.r2.cloudflarestorage.com`,credentials:{accessKeyId:r,secretAccessKey:i}})}var V=require("next/server");async function E(e){let r=await(0,Y.getSignedUrl)(g(process.env.R2_ACCOUNT_ID||"",process.env.R2_ACCESS_KEY_ID||"",process.env.R2_SECRET_ACCESS_KEY||""),new $.PutObjectCommand({Bucket:process.env.R2_BUCKET_NAME,ContentType:e.type,Key:e.name}),{expiresIn:60});return V.NextResponse.json({url:r})}0&&(module.exports={CMS,R2,S3Client});
//# sourceMappingURL=index.js.map